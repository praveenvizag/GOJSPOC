<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title></title>
    <script type="text/javascript" src="go-debug.js"></script>

    <script>
      function init() {
        var click  = document.querySelector("button");
        click.disabled=true;
        var $ = go.GraphObject.make;
        var diagram = $(go.Diagram, "myDiagramDiv",
                {
                  layout: $(go.TreeLayout,
                            { angle: 90, nodeSpacing: 60, layerSpacing: 60 }
                            ),
                            "InitialLayoutCompleted": function(e) {
      // if not all Nodes have real locations, force a layout to happen
      if (!e.diagram.nodes.all(function(n) { return n.location.isReal(); })) {
        e.diagram.layoutDiagram(true);
      }
    }
                });
       // diagram.layout = new go.TreeLayout;
        diagram.isReadOnly = true;
       
        diagram.nodeTemplate = $(go.Node,
          "Table", nodeStyle(),
          { layoutConditions: go.Part.LayoutStandard & ~go.Part.LayoutNodeSized },
          { // when the user clicks on a Node, highlight all Links coming out of the node
        // and all of the Nodes at the other ends of those Links.
        click: function(e, node) {
          console.log("node clicked");
            // highlight all Links and Nodes coming out of a given Node
            var diagram = node.diagram;
            console.dir(diagram);
            diagram.startTransaction("highlight");
            // remove any previous highlighting
            diagram.clearHighlighteds();
            // for each Link coming out of the Node, set Link.isHighlighted
            node.findLinksOutOf().each(function(l) { 
              l.isHighlighted = true; });
            // for each Node destination for the Node, set Node.isHighlighted
            node.findNodesOutOf().each(function(n) { n.isHighlighted = true; });
            diagram.commitTransaction("highlight");
          }
      },
          $(go.Panel,"Auto",
          $(go.Shape,"Rectangle",
            {width: "auto" },
            new go.Binding("fill", "isActive",function(c) {
              return c ? "lightGreen": "lightBlue";
            })
          ),
          $(go.TextBlock, 
          {verticalAlignment:go.Spot.Center,width:100, height: 40, margin: 10,isMultiline: true ,textAlign: "center",name :"TEXT" }, 
          new go.Binding("text", "key")),
          ),
          {mouseEnter : showMouserOverEvent},
          {mouseLeave :  showMouseLeaveEvent},
          //makePort("T", go.Spot.Top, go.Spot.TopSide, false, true),
          //makePort("B", go.Spot.Bottom, go.Spot.BottomSide, true, false)
          
        );

        diagram.linkTemplate = $(go.Link,
          {routing: go.Link.AvoidsNodes},
          // new go.Binding("fromSpot" ,"startNode"),
          // new go.Binding("toSpot" ,"endNode"),
          $(go.Shape, { strokeWidth: 1, stroke: "black" },
           new go.Binding("stroke","isHighlighted" ,function(e){
             console.log('is Highlighted' , e);
            return e ? "red":"black";
          }).ofObject()),
          $(go.Shape, { toArrow: "Standard", fill: "gray", stroke: null },
          new go.Binding("fill","isHighlighted" ,function(e){
            return e ? "red":"black";
          }).ofObject()),
          $(go.Shape,
          { toArrow: "Standard", strokeWidth: 0 },
        // the Shape.fill color depends on whether Link.isHighlighted is true
        new go.Binding("fill", "isHighlighted", function(h) { return h ? "red" : "black"; })
            .ofObject())
        );
        var nodeDataArray = [
          { key: "Start", isActive:true,loc: "0 0",toolTipMessage:"Node1"},
          { key: "Enter the Budget Details",isActive:false,loc: "200 0" ,toolTipMessage:"Node2"},
          { key: "Manager Approval",isActive:false,loc: "400 0",toolTipMessage:"Node2" },
          { key: "Working Node", isActive:true,loc: "800 0",toolTipMessage:"Node1"},
          { key: "Owner Accepance", isActive:true,loc: "1000 0",toolTipMessage:"Node1"},
          { key: "Order Process", isActive:true,loc: "1100 300",toolTipMessage:"Node1"},
          { key: "Order Review", isActive:false,loc: "1200 500",toolTipMessage:"Node1"},
          { key: "Owner AcceApproval OF Deliverable", isActive:true,loc: "1000 150",toolTipMessage:"Node1"},
          { key: "PCB Review", isActive:false,loc: "1400 700",toolTipMessage:"Node1"},
          { key: "End", isActive:false,loc: "600 -250",toolTipMessage:"Node2" },
          { key: "Nofification to Submit new HRF", isActive:false,loc: "600 -250",toolTipMessage:"Nofift User" },
          { key: "Head SUplier Reviews", isActive:false,loc: "800 -250",toolTipMessage:"Supplier Review User bkuho jihoi piuh huig oju iu" },
          { key: "Open Task Reaminder", isActive:true,loc: "100 -250",toolTipMessage:"Supplier Review User bkuho jihoi piuh huig oju iu" }
         
        ];
        var linkDataArray = [
          {"linkFromPortIdProperty": "fromPort",
          "linkToPortIdProperty": "toPort"},
          { from: "Start", to: "Enter the Budget Details",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T"},
          { from: "Start", to: "Open Task Reaminder",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T"},
          { from: "Start", to: "End",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T"},
          { from: "Enter the Budget Details", to: "Manager Approval",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T" },
          { from: "Manager Approval", to: "End",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T" },
          { from: "Start", to: "Working Node",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T" },
          { from: "Working Node", to: "Owner Accepance",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T" },
          { from: "Owner Accepance", to: "Order Review",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T" },
          { from: "Order Review", to: "Order Process",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T" },
          { from: "Start", to: "Order Process",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T" },
          { from: "Order Review", to: "Owner AcceApproval OF Deliverable",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T" },
          { from: "Order Review", to: "PCB Review",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T" },
          { from: "Owner AcceApproval OF Deliverable", to: "End",startNode:go.Spot.Right ,endNode:go.Spot.Left,"fromPort":"B", "toPort":"T" }
          
        ];
        function makePort(name, align, spot, output, input) {
        var horizontal = align.equals(go.Spot.Top) || align.equals(go.Spot.Bottom);
       
        return $(go.Shape,
          {
            fill: "transparent",  // changed to a color in the mouseEnter event handler
            strokeWidth: 0,  // no stroke
            width: horizontal ? NaN : 8,  // if not stretching horizontally, just 8 wide
            height: !horizontal ? NaN : 8,  // if not stretching vertically, just 8 tall
            alignment: align,  // align the port on the main Shape
            stretch: (horizontal ? go.GraphObject.Horizontal : go.GraphObject.Vertical),
            portId: name,  // declare this object to be a "port"
            fromSpot: spot,  // declare where links may connect at this port
            fromLinkable: output,  // declare whether the user may draw links from here
            toSpot: spot,  // declare where links may connect at this port
            toLinkable: input,  // declare whether the user may draw links to here
            cursor: "pointer",  // show a different cursor to indicate potential link point
            mouseEnter: function(e, port) {  // the PORT argument will be this Shape
              if (!e.diagram.isReadOnly) port.fill = "rgba(255,0,255,0.5)";
            },
            mouseLeave: function(e, port) {
              port.fill = "transparent";
            }
          });
      }
      diagram.click = function(e) {
      e.diagram.commit(function(d) { d.clearHighlighteds(); }, "no highlighteds");
     };
        diagram.model = new go.GraphLinksModel(nodeDataArray, linkDataArray);
        diagram.undoManager.isEnabled = true;
        diagram.toolManager.linkingTool.temporaryLink.routing = go.Link.Orthogonal;
        diagram.toolManager.relinkingTool.temporaryLink.routing = go.Link.Orthogonal;
      }
      function showMouserOverEvent(event, obj) {
        var msg = obj.findObject("TEXT");
        msg.text = obj.data['toolTipMessage'];
      }
      function showMouseLeaveEvent(event,obj) {
        var msg = obj.findObject("TEXT");
         msg.text = obj.data['key'];
      }
      function toolTipMessage(e,obj) {
        
        new go.Binding("text" , "key");

      }
      function nodeStyle() {
        return [
          // new go.Binding("location", "loc", go.Point.parse).makeTwoWay(go.Point.stringify),
          {
            locationSpot: go.Spot.Center
          }
        ];
      }
    </script>
  </head>

  <body>
   
    <div
      id="myDiagramDiv"
      style="border: solid 1px blue ; width: auto;height: 550px;background-color: white;" 
    ></div>
    <div>
      <button id = "clickMe" style="margin-bottom :10px " onclick="init()">Process Definition</button>
    </div>
  </body>
</html>
